<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Web of Things (WoT) Thing Description</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
    <script class='remove'>
          var respecConfig = {
              specStatus:     "ED"
            , processVersion: 2017
            , shortName:      "wot-thing-description"
            , copyrightStart: 2017
            , noLegacyStyle:  true
            , inlineCSS:      true
            , noIDLIn:        true
            , format:         "markdown"
            , wg:             "Web of Things Working Group"
            , wgURI:          "https://www.w3.org/WoT/WG/"
            , wgPublicList:   "public-wot-wg"
            , edDraftURI:     "https://w3c.github.io/wot-thing-description/"
            , githubAPI:      "https://api.github.com/repos/w3c/wot-thing-description"
            , issueBase:      "https://www.github.com/w3c/wot-thing-description/issues"
            , editors: [
                {
                  name:       "Sebastian Kaebisch"
                , w3cid:      "43064"
                , company:    "Siemens AG"
                , companyURL: "https://www.siemens.com/"
                }
              , {
                  name:       "Takuki Kamiya"
                , w3cid:      "29376"
                , company:    "Fujitsu Laboratories of America, Inc."
                , companyURL: "https://www.fujitsu.com/"
                }
              ]
            , localBiblio: {
                "JSON-SCHEMA-VALIDATION": {
                  title:    "JSON Schema Validation: A Vocabulary for Structural Validation of JSON"
                , href:     "https://tools.ietf.org/html/draft-handrews-json-schema-validation-00"
                , authors: [
                    "Austin Wright"
                  , "Henry Andrews"
                  , "Geraint Luff"
                  ]
                , status:   "Internet-Draft"
                , publisher:  "IETF"
                }
              , "JSON-SCHEMA-CORE": {
                  title:    "JSON Schema: A Media Type for Describing JSON Documents"
                , href:     "https://tools.ietf.org/html/draft-handrews-json-schema-00"
                , authors:  [
                    "Austin Wright"
                  , "Henry Andrews"
                  ]
                , status:    "Internet-Draft"
                , publisher: "IETF"
                }
              , "WOT-ARCHITECTURE" : {
                  title: "Web of Things Architecture"
                , href: "https://w3c.github.io/wot-architecture/"
                , authors:  [
                    "Kazuo Kajimoto"
                  , "Matthias Kovatsch"
                  , "Uday Davuluru"
                  ]
                , publisher: "W3C"
                , date: "20 August 2017"
                }
	      , "WOT-PROTOCOL-BINDING" : {
                  title: "Web of Things Protocol Binding Templates"
                , href: "https://w3c.github.io/wot-binding-templates/"
                , authors:  [
                    "Michael Koster"
                  ]
                , publisher: "W3C"
                , date: "12 January 2018"
                }
              }
            , otherLinks: [
                {
                  key: "Contributors"
                , data: [
                    {
                      value: "In the GitHub repository"
                    , href: "https://github.com/w3c/wot-thing-description/graphs/contributors"
                    }
                  ]
                }
              , {
                  key: "Repository",
                  data: [
                    {
                      value: "We are on GitHub"
                    , href: "https://github.com/w3c/wot-thing-description/"
                    }
                  , {
                      value: "File a bug"
                    , href: "https://github.com/w3c/wot-thing-description/issues"
                    }
                  ]
                }
              ]
            };
    </script>
<style>
.example {
		border-color: #EA1252;
		background: #FEF11E;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
</style>
</head>
<body>

  <p class="ednote" title="First draft based on Simplified TD">
  This is the first draft of the new simplified TD approach based 
  on JSON-LD 1.1. 
  Some definitions are not finished yet and are still in progress. 
  A stable Thing Description deliverable version based on JSON-LD 1.0 
  can be found 
  <a href="https://www.w3.org/TR/2018/WD-wot-thing-description-20180405/">here</a>. 
  </p>

  <section id="abstract">
  <p>
  This document describes a formal model and a common representation 
  for a Web of Things (WoT) Thing Description. 
  A Thing Description describes the metadata and interfaces of Things, 
  where a Thing is an abstraction of a physical or virtual entity that 
  provides interactions to and participates in the Web of Things. 
  Thing Descriptions provide a set of interactions based on a small vocabulary 
  that makes it possible both to integrate diverse devices and 
  to allow diverse applications to interoperate. 
  Thing Descriptions, by default, are encoded in JSON-LD. 
  JSON-LD provides both a powerful foundation to represent knowledge 
  about Things and simplicity, 
  since it allows processing as a JSON document. 
  A Thing Description instance can be hosted by the Thing itself or hosted 
  externally when a Thing has resource restrictions (e.g., limited memory space) 
  or when a Web of Things-compatible legacy device is retrofitted 
  with a Thing Description.
  </p>
  </section>

  <section id="sotd">
  <p>
  Implementers need to be aware that this specification is considered unstable. 
  Vendors interested in implementing this specification before it eventually 
  reaches the Candidate Recommendation phase should subscribe to the 
  <a href="https://github.com/w3c/wot-thing-description">repository</a>
  and take part in the discussions.
  </p>
  <p class="ednote" title="The W3C WoT WG is asking for feedback">
  Please contribute to this draft using the 
  <a href="https://github.com/w3c/wot-thing-description/issues">GitHub Issue</a> 
  feature of the 
  <a href="https://github.com/w3c/wot-thing-description/">WoT Thing Description</a> 
  repository.
  For feedback on security and privacy considerations, 
  please use the
  <a href="https://github.com/w3c/wot-security/issues">WoT Security and Privacy</a> 
  Issues,
  as security and privacy is cross-cutting over all our documents.
  </p>
  </section>

  <section id="introduction">
  <h1>Introduction</h1>
  <p>
  The W3C Thing Description (TD) is a central building block in a Web of Things 
  (WoT) enabled system and can be considered as the entry point of a Thing 
  (much like the <i>index.html</i> of a web site). 
  The TD consists of semantic metadata for the Thing itself,
  an interaction model based on WoT's <code>Properties</code>,
  <code>Actions</code>, and <code>Events</code> paradigm, 
  a semantic schema to make data models machine-understandable, 
  and features for Web Linking to express relations among Things. 
  </p>
  <p>
  Properties can be used for controlling (or retrieving) parameters, 
  such as a setting an operation state (or getting the current value). 
  Actions model invocation of physical processes, 
  but can also be used to abstract RPC-like calls of existing platforms. 
  Events are used for interactions that use the push model of
  communication where state change notifications, 
  discrete events, 
  and streams of values are sent asynchronously to the receiver. 
  In general, the TD provides metadata for different communication bindings 
  (e.g., HTTP, CoAP, MQTT, etc.), 
  mediaTypes (e.g., "application/json", "application/xml", "application/cbor", 
  "application/exi" etc.), 
  and security mechanisms (for authentication, authorization, 
  confidentiality, etc.). 
  Serialization of TD instances is based on JSON and includes at least 
  the TD core vocabulary as JSON keys as defined in this specification document.
  </p>
  <p>
  Example 1 shows a simple TD instance in such a JSON serializiation that 
  reflects WoT's <code>Properties</code>, <code>Actions</code>, 
  and <code>Events</code> paradigm 
  by describing a lamp Thing with the name <i>MyLampThing</i>.
  </p>
<pre id="simple-thing-description-sample" 
     class="example" title="Simple Thing Description Sample with JSON serialization">
{
    "id": "urn:dev:wot:com:example:servient:lamp",
    "name": "MyLampThing",
    "security": [{"scheme": "basic"}],
    "properties": {
        "status" : {
            "type": "string",
            "forms": [{"href": "https://mylamp.example.com/status"}]
        }
    },
    "actions": {
        "toggle" : {
            "forms": [{"href": "https://mylamp.example.com/toggle"}]
        }
    },
    "events":{
        "overheating":{
            "type": "string",
            "forms": [{"href": "https://mylamp.example.com/oh"}]
        }
    }
}
</pre>
  <p>
  Based on this content, 
  we know there exists one <code>Property</code> interaction resource 
  with the name <i>status</i>. 
  In addition, 
  information is provided to indicate that this Property is accessible via 
  (the secure form of) the HTTP protocol with a GET method 
  at the URI <code>https://mylamp.example.com/status</code> 
  (announced within the <code>forms</code> structure by the 
  <code>href</code> key), and will return a string status value.
  The use of the GET method is not stated explicitly but is 
  the default assumption made by the W3C WoT 
  protocol template deliverable [[!WOT-PROTOCOL-BINDING]].
  </p>
  <p>
  In a similar manner an <code>Action</code> is specified to toggle the 
  switch status using the POST method applied to the 
  <code>https://mylamp.example.com/toggle</code> resource 
  (see again the HTTP protocol binding description in the W3C WoT protocol 
  template deliverable [[!WOT-PROTOCOL-BINDING]]).
  </p>
  <p>
  The WoT's <code>Event</code> model enables a mechanism for events to be 
  notified by a Thing. 
  Here, a subscription to be notified upon a possible overheating event 
  of the lamp can be obtained by using the default event-handling mechanism 
  defined in the protocol binding for HTTP at 
  <code>https://mylamp.example.com/oh</code> 
  (see again the HTTP protocol binding description in the W3C WoT protocol 
  template deliverable [[!WOT-PROTOCOL-BINDING]]).
  </p>
  <p>
  This example also specifies the <code>basic</code> security scheme, 
  requiring a username and password for access.
  In combination with the use of the HTTP protocol this indicates the use of 
  HTTP Basic Authentication.
  Specification of a security scheme at the top level as in this example 
  indicates that it is required for every resource.
  However, security schemes can also be specified per-interaction or per-form,
  with lower-level configurations overriding higher-level ones,
  allowing for the specification of fine-grained access control.
  Examples are provided later.
  </p>
  <p>
  The TD in Example 1 reflects some additional defined default assumptions 
  that are not explicitly described. 
  For example, the media type of the 
  exchange format of the interactions is assumed to be JSON 
  (=<code>mediaType</code>) and the <code>Property</code> <i>status</i> 
  resource is not writable as well as not observable. 
  Specifically, 
  the TD specification defines vocabulary terms 
  (<code>writable</code>, <code>observable</code>, <code>mediaType</code>) 
  that have default values. 
  If these vocabulary terms are not explicitly used in a Thing Description 
  instance, 
  the Thing Description processor follows default assumptions for 
  interpretation as defined in this specification.
  </p>
  <p>
  The TD can be also processed as an RDF-based model. 
  In that case, the Thing Description instance can be transformed 
  into valid JSON-LD first.  
  In terms of JSON-LD 1.1 serialization, 
  RDF semantic processing's open-world assumption requires vocabulary terms 
  with default values to be always present explicitly in the instances. 
  Example 2 shows the same TD in a JSON-LD 1.1 serializiation representing
  exactly the same information as in Example 1; however, default values
  have been filled in.
  </p>
<pre id="thing-description-as-json-ld-1-1-serialization" 
     class="example" title="Thing Description as JSON-LD 1.1 Serializiation">
{
    "@context": "http://www.w3.org/ns/td",
    "id": "urn:dev:wot:com:example:servient:lamp",
    "name": "MyLampThing",
    "security": [{"scheme": "basic", "in": "header"}],
    "properties": {
        "status": {
            "writable": false,
            "observable": false,
            "type": "string",
            "forms": [{
                "href": "https://mylamp.example.com/status",
                "mediaType": "application/json"
            }]
        }
    },
    "actions": {
        "toggle": {
            "forms": [{
                "href": "https://mylamp.example.com/toggle",
                "mediaType": "application/json"
            }]
        }
    },
    "events": {
        "overheating": {
            "type": "string",
            "forms": [{
                "href": "https://mylamp.example.com/oh",
                "mediaType": "application/json"
            }]
        }
    }
}
 </pre>
  <p>
  For more examples, including the use of other protocols besides HTTP,
  see <a href="#example-serialization" class="sec-ref">Section 7.</a>
  </p>
  </section>

  <section id="terminology"> 
  <h2>Terminology</h2>
  <p>Generic WoT terminology is defined in [[!WOT-ARCHITECTURE]]: 
  <dfn data-lt="Things">Thing</dfn>, 
  <dfn data-lt="Thing Descriptions">Thing Description</dfn> 
    (in short <dfn>TD</dfn>), 
  <dfn>Web of Things</dfn> (in short <b><i>WoT</i></b>),  
  <dfn>WoT Interface</dfn> etc.
  </p>
  </section>

  <section>
  <h1>Namespaces</h1>
  <p>
  The namespace for the W3C Thing Description vocabulary as defined in 
  this document is <a href="http://www.w3.org/ns/td">http://www.w3.org/ns/td</a>. 
  </p> 
  <p>
  Using content negotiation, 
  this namespace serves either the TD ontology file (Turtle) 
  or the TD context file (JSON-LD).
  </p>
  <p>
  The security ontology that can be used with the Thing Description 
  is available at 
  <a href="https://www.w3.org/ns/wot-security">https://www.w3.org/ns/wot-security</a>. 
  </p>
  <p>
  The data schema ontology that can be used with the Thing Description is 
  available at 
  <a href="https://www.w3.org/ns/json-schema">https://www.w3.org/ns/json-schema</a>. 
  </p>
  </section>

  <section>
  <h1>Conformance</h1>
  <p>
  As well as all sections marked as non-normative, 
  all authoring guidelines, diagrams, examples, and notes in this specification 
  are non-normative. 
  Everything else in this specification is normative.
  </p>
  <p>
  The key words 
  <em title="MUST" class="rfc2119">MUST</em>, 
  <em title="MUST NOT" class="rfc2119">MUST NOT</em>, 
  <em title="REQUIRED" class="rfc2119">REQUIRED</em>, 
  <em title="SHOULD" class="rfc2119">SHOULD</em>, 
  <em title="SHOULD NOT" class="rfc2119">SHOULD NOT</em>, 
  <em title="RECOMMENDED" class="rfc2119">RECOMMENDED</em>, 
  <em title="MAY" class="rfc2119">MAY</em>,
  and <em title="OPTIONAL" class="rfc2119">OPTIONAL</em> 
  in this specification are to be interpreted as described in [[!RFC2119]].
  </p>
  <p>
  A Thing Description instance complies with this specification if it follows 
  the normative statements in Section 
  <a href="#vocabularyDefinitionSection" class="sec-ref"><span class="secno">5.</span> 
  <span class="sec-title">Vocabulary Definition</span></a> 
  and Section 
  <a href="#TD-serialization-section" class="sec-ref"><span class="secno">6.</span> 
  <span class="sec-title">Thing Description Serializations</span></a> 
  regarding Thing Description serialization.
  </p>
  <p>
  A JSON Schema is provided in Annex 
  <a href="#json-schema-4-validation" class="sec-ref"><span class="secno">A</span> 
  <span class="sec-title">JSON Schema for TD Instance Validation</span></a> 
  to validate Thing Description instances based on JSON-LD 1.1.
  </p>

  <p class="ednote">
  In the future some information about RDF validation will be provided.   
  </p>

  </section>



{vocabulary.template}



  <section id="TD-serialization-section">
  <h1 >Thing Description Serialization</h1>

  <p class="ednote" title="JSON-LD 1.1 ">
  This is the first draft that uses JSON-LD 1.1 as a serialization format 
  of the Thing Description. 
  As this is a work in progress, working assumptions are based on the latest
  <a href="https://json-ld.org/spec/latest/json-ld/#">Community Draft of JSON-LD 1.1</a>. 
  There is a plan to set up a JSON-LD Working Group with the following 
  <a href="https://www.w3.org/2018/03/jsonld-wg-charter.html">JSON-LD Working Group Charter</a>. 
  It is planned that this section will conform to the latest working draft 
  of JSON-LD 1.1.
  </p>

  <p>
  Thing Description instances are modeled and structured based on the 
  <a href="#vocabularyDefinitionSection" class="sec-ref">Thing Description Information Model</a>. 
  This section proposes a TD serialization based on JSON-LD 1.1. 
  </p>

  <section id="json-serializiation-section">
  <h1>Representation Format</h1>

  <p>
  This section introduces the JSON-based serialization of the Thing Description. 
  This serialization also follows the syntax of JSON-LD 1.1 
  in order to streamline the semantic evaluation of TDs.
  </p>

  <p>
  In order to enable this convergence,
  all vocabulary terms defined in 
  <a href="#sec-vocabulary-definitions" class="sec-ref">Vocabulary Definitions</a> 
  will have a JSON key representation.
  </p>
  <p>
  In addition,
  <span class="rfc2119-assertion" id="td-string-type">
  Thing Description instances MAY contain JSON-LD 1.1 keys such as 
  <code>@context</code> and <code>@type</code>.</span>
  </p>

  <!--<p>JSON TD MAY contain vocabulary terms that are not in the 
  Thing Description core model. 
  These vocabulary terms MUST carry a prefix for identification 
  within the key name (e.g., "http:header").</p>-->

  <p>
  The defined types of the vocabulary as defined in 
  <a href="#sec-vocabulary-definitions" class="sec-ref">Vocabulary Definitions</a> 
  will be transformed to JSON-based types. 
  The following rules are used for vocabulary terms based on some simple type 
  definitions:
  </p>
  <ul>
  <li><span class="rfc2119-assertion" id="td-string-type">
        Vocabulary terms that use simple types string and anyURI
        MUST be serialized as JSON string.
  </span></li>
  <li><span class="rfc2119-assertion" id="td-integer-type">
        Vocabulary terms that use simple type unsignedInt
        MUST be serialized as JSON integer.
  </span></li>
  <li><span class="rfc2119-assertion" id="td-number-type">
        Vocabulary terms that use simple type double
        MUST be serialized as JSON number.
  </span></li>
  </ul>

  <p>
  All vocabulary terms in the
  <a href="#sec-vocabulary-definitions" class="sec-ref">Vocabulary Definitions</a> Section 
  associated with more complex class-based types are defined separately for 
  structured JSON type transformation in the following subsections.
  </p>

  <section id="sec-thing-as-a-whole-json">
  <h2>Thing as a whole</h2>

  <p><span class="rfc2119-assertion" id="td-context">
  The first line of a Thing Description instance MAY include the 
  <code>@context</code> key from JSON-LD 1.1 with the value URI of 
  the Thing description context file <code>http://www.w3.org/ns/td</code>.
  </span></p>

<pre class="example">
{  
    "@context": "http://www.w3.org/ns/td",
    ...
}
</pre>

  <p><span class="rfc2119-assertion" id="td-context-jsonld">
  When a Thing Description instance is processed and interpreted by a 
  JSON-LD 1.1 processor the <code>@context</code> with its value 
  MUST be present</span> 
  (see also Section <a href="#note-jsonld-processing" class="sec-ref">JSON-LD 1.1 Processing</a>). 
  </p>

  <p><span class="rfc2119-assertion" id="td-additional-contexts">
  When a single Thing Description instance involves several contexts, 
  additional namespaces with prefixes MUST be appended to the 
  <code>@context</code> array structure.</span> 
  This option proves relevant if one wants to extend the existing 
  Thing Description context without modifying it. For instance:
  </p>
<pre class="example">
{
    "@context": ["http://www.w3.org/ns/td",
                {"sensor": "http://iotschema.org/"}],
    ...
}
</pre>

  <p><span class="rfc2119-assertion" id="td-context-toplevel">
  Each mandatory and optional vocabulary, 
  as defined in the class <a href="#thing" class="sec-ref">Thing</a>, 
  MUST be serialized as a JSON key 
  at the top level of the Thing Description instance.
  </span></p>

  <!-- should this be "the type" or "the elements of"? -->
  <p><span class="rfc2119-assertion" id="td-objects">
  The type of the fields <code>properties</code>, <code>actions</code>, 
  and <code>events</code> MUST be serialized as a JSON object.
  </span></p>

  <p><span class="rfc2119-assertion" id="td-arrays">
  The type of the field <code>links</code> and <code>security</code> 
  MUST be serialized as a JSON array.
  </span></p>

  <p>
  An example of a TD snippet based on the defined fields of the 
  <a href="#thing" class="sec-ref">Thing</a> information model 
  without the optional field <code>@context</code> is given below:
  </p>
<pre class="example">
{
    "id": "urn:dev:wot:com:example:servient:myThing",
    "name": "MyThing",
    "description": "Additional (human) readable information of the Thing.",
    "support": "https://servient.example.com/contact",
    "security": [...],
    "base": "https://servient.example.com/",
    "properties": {...},
    "actions": {...},
    "events": {...},
    "links": [...]
}
</pre>

  <p>Alternatively, the same example can be written instead to 
  explicitly include the (semantic) keys used by JSON-LD 1.1 
  (<code>@context</code> and <code>@type</code>):
  </p>
<pre class="example">
{
    "@context": "http://www.w3.org/ns/td",
    "@type": "Thing",
    "id": "urn:dev:wot:com:example:servient:myThing",
    "name": "MyThing",
    "description": "Additional (human) readable information of the Thing.",
    "support": "https://servient.example.com/contact",
    "security": [...],
    "base": "https://servient.example.com/",
    "properties": {...},
    "actions": {...},
    "events": {...},
    "links": [...]
}
</pre>

 </section> <!-- end of id="sec-thing-as-a-whole-json"-->

 <section id="property-serialization-json">
 <h2>properties</h2>
  
  <p><span class="rfc2119-assertion" id="td-properties">
  Properties (and sub-properties) offered by a Thing MUST be collected 
  in the JSON object-based <code>properties</code> field 
  of (unique) Property names as JSON keys.
  </span></p>

  <span class="rfc2119-assertion" id="td-property-keys">
  Each mandatory and optional vocabulary, 
  as defined in the class <a href="#property" class="sec-ref">Property</a>, 
  its two superclasses 
  <a href="#interactionPattern" class="sec-ref">InteractionPattern</a> 
  and <a href="#dataschema" class="sec-ref">DataSchema</a>, 
  MUST be serialized as a JSON key within a Property field.
  </span></p>

  <p><span class="rfc2119-assertion" id="td-property-objects">
  The type of the fields <code>properties</code> and <code>items</code> 
  MUST be serialized as a JSON object.
  </span></p>

  <p><span class="rfc2119-assertion" id="td-property-arrays">
  The type of the fields <code>forms</code>, <code>required</code>, 
  and <code>enum</code> MUST be serialized as a JSON array.
  </span></p>

  <p>
  An example of a TD snippet based on the defined fields is given below:
  </p>
<pre class="example">
{
    ...
    "properties": {
        "on": {
            "label": "On/Off",
            "type": "boolean"
        },
        "status": {
            "type": "object",
            "properties": {
                "brightness": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 100.0
                 },
                 "rgb": {
                    "type": "array",
                    "items" : {
                        "type" : "number",
                        "minimum": 0,
                        "maximum": 255
                    },
                    "minItems": 3,
                    "maxItems": 3
                }
            },
            "required": ["brightness","rgb"],
            "forms": [...]
        }
    }
    ...
}
</pre>

  <p><span class="rfc2119-assertion" id="td-property-semantic">
  Similar to case at the <code>Thing</code> level,
  properties MAY have additional semantic annotations based on 
  JSON-LD 1.1 keys.
  </span></p>

  <p><span class="rfc2119-assertion" id="td-property-defaults">
  When a Thing Description instance is processed and interpreted by 
  a JSON-LD 1.1 processor, 
  each <code>property</code> MUST contain the vocabulary terms 
  <code>observable</code> and <code>writable</code> due to the linked data's 
  <a href="https://en.wikipedia.org/wiki/Open-world_assumption">open-world assumption</a>.
  </span>
  This assumption means that if a Thing Description instance 
  were to omit these vocabulary terms, 
  then the interpreter would not be able to make any assumptions
  about their actual value. 
  </p>

  <p>
  An example of a JSON-LD 1.1 serialization of a TD snippet 
  including semantic annotations and the 
  default values of <code>observable</code> and <code>writable</code> 
  based on class <a href="#property" class="sec-ref">Property</a> definition
  is given as follows:
  </p>
<pre class="example">
    ...
    "properties": {
        "on": {
            "@type": "iot:SwitchToggle",
            "label": "On/Off",
            "writable": false,
            "observable": false,
            "type": "boolean",
            "forms": [...]
        },
        "status": {
            "writable": false,
            "observable": false,
            "type": "object",
            "properties": {
                "brightness": {
                    "@type": "iot:CurrentLevel",
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 100.0
                },
                "rgb": {
                    "@type": "iot:rgbData",
                    "type": "array",
                    "items" : {
                        "type" : "number",
                        "minimum": 0,
                        "maximum": 255
                    },
                    "minItems": 3,
                    "maxItems": 3
                }
            },
            "required": ["brightness","rgb"],
            "forms": [...]
        }
    }
    ...
</pre>

    </section> <!-- end of id="property-serialization-json"-->

    <section id="action-serialization-json">
    <h2>actions</h2>

    <p>
    Actions offered by a Thing are collected in the JSON object-based 
    <code>actions</code> field of (unique) Action names as JSON keys. 
    <span class="rfc2119-assertion" id="td-actions">
    Each optional vocabulary term,
    as defined in the class <a href="#action" class="sec-ref">Action</a> 
    and its superclass 
    <a href="#interactionPattern" class="sec-ref">InteractionPattern</a>,
    MUST be serialized as a JSON key within a Action field.
    </span></p>

    <p><span class="rfc2119-assertion" id="td-action-objects">
    The type of the fields <code>input</code> and <code>output</code> 
    MUST be serialized as a JSON object.
    </span></p>

    <p>The member keys of <code>input</code> and <code>output</code> 
    rely on the the class <a href="#property" class="sec-ref">Property</a>.
    </p>

    <p><span class="rfc2119-assertion" id="td-action-arrays">
    The type of the field <code>forms</code> 
    MUST be serialized as a JSON array.
    </span></p>

    <p>An example of a TD snippet based on the defined fields is 
    given below:
    </p>

<pre class="example">
    ...
    "actions": {
        "fade" {
            "label": "Fade in/out",
            "description": "Smooth fade in and out animation.",
            "input": {
                "type": "object",
                "properties": {
                    "from": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 100
                    },
                    "to": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 100
                    },
                    "duration": {"type": "number"}
                },
                "required": ["to","duration"],
            },
            "output": {"type": "string"},
            "forms": [...]
        }
        ...
    }
    ...
</pre>

  <p><span class="rfc2119-assertion" id="td-action-semantic">
  Definitions within the  <code>actions</code> level 
  MAY have also additional semantic annotations based on JSON-LD 1.1 keys.
  </span></p>

  </section> <!-- end of id="action-serialization-json"-->

  <section id="event-serialization-json">
  <h2>events</h2>

  <p>
  Events (and sub-events) offered by a Thing are collected in the JSON 
  object-based <code>events</code> field with (unique) Event names as 
  JSON keys.
  <span class="rfc2119-assertion" id="td-events">
  Each optional vocabulary term, 
  as defined in the class <a href="#event" class="sec-ref">Event</a>, 
  as well as its two superclasses 
  <a href="#interactionPattern" class="sec-ref">InteractionPattern</a> 
  and <a href="#dataschema" class="sec-ref">DataSchema</a>, 
  MUST be serialized as a JSON key within a Event field.
  </span></p>

  <p><span class="rfc2119-assertion" id="td-event-objects">
  The type of the fields <code>properties</code> and <code>items</code> 
  MUST be serialized as a JSON object.
  </span></p>

  <p><span class="rfc2119-assertion" id="td-event-arrays">
  The type of the fields <code>forms</code>, <code>required</code>, 
  and <code>enum</code> MUST be serialized as a JSON array.
  </span></p>

  <p>
  An example of a TD snippet based on the defined fields is given below:
  </p>
<pre class="example">
    ...
    "event": {
        "overheated": {
            "type": "object",
            "properties": {
                "temperature": { "type": "number" }
            },
            "forms": [...]
        }
        ...
    }
    ...
</pre>

  <p><span class="rfc2119-assertion" id="td-action-semantic">
  Definitions within the  <code>events</code> level 
  MAY have also additional semantic anotations 
  based on JSON-LD 1.1 keys.
  </span></p>

  </section> <!-- end of id="event-serialization-json"-->

  <section id="form-serialization-json">
  <h2>forms</h2>

  <p><span class="rfc2119-assertion" id="td-forms">
  Each mandatory and optional vocabulary term,
  as defined in the class <a href="#form" class="sec-ref">Form</a>, 
  MUST be serialized as a JSON key.
  </span></p>

  <p><span class="rfc2119-assertion" id="td-form-protocolbindings">
  If required, <code>forms</code> 
  MAY be supplemented with protocol-specific vocabulary terms 
  identified with a prefix. 
  </span>
  See also [[!WOT-PROTOCOL-BINDING]].
  </p>

  <p><span class="rfc2119-assertion" id="td-form-mediatype">
  When a Thing Description instance is processed and interpreted 
  by a JSON-LD 1.1 processor, 
  each <code>forms</code> (array) entry 
  MUST contain a <code>mediaType</code> 
  due to linked data's 
  <a href="https://en.wikipedia.org/wiki/Open-world_assumption">open-world assumption</a>.
  </span>
  This assumption means that if a Thing Description instance 
  were to omit these vocabulary terms, 
  then the interpreter would not be able to make any assumptions
  about their actual value. 
  </p>

  <p>An example of a TD snippet based on the defined fields is given below:</p>
<pre class="example">
    ...
    "forms": [{
        "href" : "http://mytemp.example.com:5683/temp",
        "mediaType": "application/json",
        "http:methodName": "POST",
        "rel": "writeProperty",
        "security": [{"scheme":"basic","in":"header"}]
    }]
    ...
</pre>

    </section> <!-- end of id="form-serialization-json"-->

    <section id="links-serialization-json">
    <h2>links</h2>

    <p><span class="rfc2119-assertion" id="td-links">
    Each mandatory and optional vocabulary term, 
    as defined in the class <a href="#link" class="sec-ref">Link</a>, 
    MUST be serialized as a JSON key.
    </span></p>

    <p>An example of a TD snippet based on the defined fields is given below:</p>

<pre class="example">
    ...
    "links": [{
        "href": "https://servient.example.com/things/lampController",
        "rel": "controlledBy",
        "mediaType": "application/td"
    }]
    ...
</pre>

    </section> <!-- end of id="links-serialization-json"-->

    <section id="security-serialization-json">
    <h2>security</h2>

    <p><span class="rfc2119-assertion" id="td-security">
    Each mandatory and optional vocabulary term, 
    as defined in the class 
    <a href="#security" class="sec-ref">SecurityScheme</a>, 
    MUST be serialized as a JSON key.
    </span></p>

    <p>
    The following TD snippet example shows a simple security configuration specifying
    basic username/password authentication in the header.
    The value of <code>in</code> given is actually the default value of
    <code>header</code>.
    </p>
<pre class="example" id="security-basic-example">
   ...
   "security": [{
       "scheme": "basic",
       "in": "header"
   }]
   ...
</pre>

    <p>
    Here is a more complex example: a TD snippet showing digest 
    authentication on a proxy combined with bearer token authentication 
    on an endpoint.  
    Here the default 
    value of <code>in</code> in the <code>digest</code> scheme,
    <code>header</code>, is implied.
    </p>
<pre class="example" id="security-digest-example">
    ...
    "security": [
        {
           "scheme": "digest",
           "proxyUrl": "https://portal.example.com/"
        },
        {
           "scheme": "bearer",
           "format": "jwt",
           "alg": "ES256",
           "authorizationUrl": "https://servient.example.com:8443/"
        }
    ]
    ...
</pre>

    <p>
    Security definitions can be given at more than one level.
    In this case, definitions at the lower levels override (completely replace)
    the definitions at the higher level.  
    </p>

    <p>
    Security configuration is mandatory. 
    <span class="rfc2119-assertion" id="td-security-mandatory">
    Every form in a Thing MUST have a security configuration either provided 
    in the form itself,
    at the interaction level directly above it 
    (if security is not configured in the form),
    or at the Thing level 
    (if security is not configured in either the form or at the
    interaction level).
    </span>
    In the vocabulary defined above,
    note that <code>security</code> is marked as non-mandatory.
    However, this is only true locally (at a specific level),
    and only if the security is configured at a higher or
    lower level.
    In other words, a security
    configuration must be provided at <em>some</em> level for each form.
    </p>
    <p>
    Security configuration is considered binding.
    <span class="rfc2119-assertion" id="td-security-binding">
    The security configuration metadata provided in a Thing Description 
    MUST accurately reflect the
    security requirements of the Thing.
    </span>  
    Some protocols can ask for authentication dynamically.  
    If a protocol asks for
    a form of security credentials not declared in the Thing Description 
    then the Thing Description
    is to be considered invalid.
    </p>
    <p>
    The <code>nosec</code> security scheme is provided for the case that 
    no security is needed.
    The minimal security configuration for a Thing is configuration 
    of the <code>nosec</code> security scheme 
    at the top level, as in the following example:
    </p>
<pre class="example">
{
    "name": "MyThing",
    "id": "urn:dev:wot:com:example:servient:myThing",
    "base": "https://servient.example.com/",
    "description": "Additional (human) readable information of the Thing.",
    "support": "https://servient.example.com/contact",
    "security": [{"scheme": "nosec"}],
    "properties": {...},
    "actions": {...},
    "events": {...},
    "links": [...]
}
</pre> 

    <p>
    To give a more complex example, 
    suppose we have a Thing where all interactions
    require basic authentication except for one interaction for which
    no authentication is required.
    In the following, the <code>nosec</code> scheme for
    the security configuration in the <code>overheating</code> event 
    to indicate no authentication is required.  
    For the <code>status</code> property and the <code>toggle</code>
    action, however, <code>basic</code> authentication is required, as defined
    at the top level of the Thing.
    </p>
<pre class="example">
{
    ...
    "security": [{"scheme": "basic"}],
    "properties": {
        "status": {
            ...
            "forms": [{
                "href": "https://mylamp.example.com/status",
                "mediaType": "application/json",
            }]
        }
    },
    "actions": {
        "toggle": {
            ...
            "forms": [{
                "href": "https://mylamp.example.com/toggle",
                "mediaType": "application/json"
            }]
        }
    },
    "events": {
        "overheating": {
            ...
            "forms": [{
                "href": "https://mylamp.example.com/oh",
                "mediaType": "application/json",
                "security": [{"scheme": "nosec"}] 
            }]
        }
    }
}
</pre>

      <p>
      Security definitions can also can be given for different elements
      at the same level.  This may be required for devices that support
      multiple protocols, for example CoAP and HTTP, with support for different
      security mechanisms.  This is also useful when alternative authentication
      mechanisms are allowed.  Here is a TD snippet demonstrating three possible
      ways to access a resource: via HTTPS with basic authentication, via HTTPS
      via digest authentication, or via CoAPS with an API key.
      In other words, 
      the use of multiple security configurations at the same level 
      provides a way to combine security mechanisms an in "OR" fashion.
      In contrast, putting multiple security configurations in the same
      <code>security</code> field combines them in an "AND" fashion, 
      since in that case
      they would all need to be satisfied to allow access to the resource.
      </p>
<pre class="example">
    ...
    "properties": {
        "status": {
            ...
            "forms": [
                {
                    "href": "https://mylamp.example.com/status",
                    "mediaType": "application/json",
                    "security": [{"scheme": "basic"}]
                },
                {
                    "href": "https://mylamp.example.com/status",
                    "mediaType": "application/json",
                    "security": [{"scheme": "digest"}]
                },
                {
                    "href": "coaps://mylamp.example.com:5683/status",
                    "mediaType": "application/json",
                    "security": [{"scheme": "apikey"}]
                }
            ]
        }
    },
    ...
</pre>

  </section> <!-- end of id="security-serialization-json"-->

  </section> <!-- end of id="serialization-json"-->

  <section id="media-type-section">  
  <h1>Media Type</h1>

  <p>
  The JSON-based serialization of the TD is identified by 
  the media type <code>application/td+json</code>.
  </p>

  <p><span class="rfc2119-assertion" id="td-media-type">
  The media type <code>application/td+json</code>
  MUST be also associated with the JSON-LD context 
  <code>http://www.w3.org/ns/td</code>.
  </span>
  That means that this media type can also be used for contextual  
  identification of the vocabulary within a (simplified) TD instance 
  that may omit the <code>@context</code> key term.
  </p>

  <p class="ednote" title="Media Type">
  The <code>application/td+json</code> media type has not registered  
  with IANA yet.
  </p>

  </section>

  <section id="Implementation-Note-section">
  <h2>Implementation Notes</h2>

  <section id="note-json-processing">
  <h2>JSON Processing</h2>
  <p>
  The minimum requirement to read the content of a Thing Description 
  instance is a (simple) JSON parser.
  </p>

  <p><span class="rfc2119-assertion" id="td-writable-observable-default">
  If the key terms <code>writable</code> and/or <code>observable</code> 
  are not present within a <code>properties</code> definition,
  the default value defined in 
  the <a href="#vocabularyDefinitionSection">Vocabulary Definition</a> 
  MUST be assumed.
  </span></p>
  
  <p><span class="rfc2119-assertion" id="td-media-type-default">
  If the <code>mediaType</code> key term is not present within a 
  <code>forms</code> definition, the default value as defined in the
  <a href="#vocabularyDefinitionSection">Vocabulary Definition</a> 
  MUST be assumed.   
  </span></p>

  <p>
  To validate the semantic meaning and follow references to external 
  context vocabulary terms (e.g., iot.schema.org), use of JSON-LD or RDF-based  
  tools and libraries is highly recommended 
  as explained in the next sub-section. 
  </p>

  </section>

  <section id="note-jsonld-processing">
  <h2>JSON-LD 1.1 Processing</h2>

  <p>To interpret the semantic meaning of a Thing Description
  in terms of RDF triples, 
  a Thing Description instance first requires a valid JSON-LD 1.1 
  representation based on this Thing Description specification. 
  Then this representation can be passed to a JSON-LD 1.1 interpreter.
  </p>

  <p><!-- The following is not marked as a testable assertion because it 
          simply says the next three are assertions.
          The subassertions have been reworded so they can be understood 
          independently as referring to preprocessing.
          This is why "must" is in lower case.  -->
  The following pre-processing steps of a Thing Description instance 
  must be executed before starting JSON-LD 1.1 based processing:
  <ul>
  <li><span class="rfc2119-assertion" id="td-jsonld-preprocessing-context">
     Before starting JSON-LD 1.1 processing of a Thing Description instance,
     there MUST be a <code>@context</code> key from JSON-LD 1.1 as defined 
     in Section 
     <a href="#sec-thing-as-a-whole-json" class="sec-ref">Thing as a whole</a>.
  </span></li>
  <li><span class="rfc2119-assertion" id="td-jsonld-preprocessing-prefix">
     Before starting JSON-LD 1.1 processing of a Thing Description instance,
     all external vocabulary terms used in the Thing Description MUST 
     provide their context URIs as prefix or within the <code>@context</code>.
  </span></li>
  <li><span class="rfc2119-assertion" id="td-jsonld-preprocessing-defaults">
     Before starting JSON-LD 1.1 processing of a Thing Description instance,
     all vocabulary terms that have a default value as defined in the 
     <a href="#vocabularyDefinitionSection">Vocabulary Definition</a> Section
     MUST be present at least with their default value.
  </span></li>
  </ul>
  </p>

  <!-- FIX: Actually, the examples in the next section
       are not that good because they
       show semantic annotation in the "output" that is not in the "input"!
       So I have redirected this to examples 1 and 2.
  -->
  <p>
  The 
  <a href="#introduction">Introduction</a>  
  Section shows an example of how the input and output of such
  preprocessing would appear.
  </p>

  </section>
  </section>

  </section> <!-- end of id="TD-serialization-section"-->

  <section id="example-serialization">
  <h2>Example Thing Description Instances</h2>

  <section id="myLampThing-example-serialization">
  <h3>MyLampThing Example</h3>

<pre class="example" title="MyLampThing represented as a compact JSON serialization">
{
    "id": "urn:dev:wot:com:example:servient:lamp",
    "name": "MyLampThing",
    "description" : "MyLampThing uses JSON-LD 1.1 serialization",
    "security": [{"scheme": "psk"}],
    "properties": {
        "status": {
            "description" : "Shows the current status of the lamp",
            "type": "string",
            "forms": [{
                "href": "coaps://mylamp.example.com/status"
            }]
        }
    },
    "actions": {
        "toggle": {
            "description" : "Turn on or off the lamp",
            "forms": [{
                "href": "coaps://mylamp.example.com/toggle"
            }]
        }
    },
    "events": {
        "overheating": {
            "description" : "Lamp reaches a critical temperature (overheating)",
            "type": "string",
            "forms": [{
                "href": "coaps://mylamp.example.com/oh"
            }]
        }
    }
}
</pre>


<pre class="example" title="MyLampThing with semantic annotations based on a valid JSON-LD 1.1 representation">
{
    "@context": ["http://www.w3.org/ns/td", 
    		{"iot": "http://iotschema.org/"}],
    "@type" : "Thing",
    "id": "urn:dev:wot:com:example:servient:lamp",
    "name": "MyLampThing",
    "description" : "MyLampThing uses JSON-LD 1.1 serialization",
    "security": [{"scheme": "psk"}],
    "properties": {
        "status": {
            "@type" : "iot:SwitchStatus",
            "description" : "Shows the current status of the lamp",
            "writable": false,
            "observable": false,
            "type": "string",
            "forms": [{
                "href": "coaps://mylamp.example.com/status",
                "mediaType": "application/json"
            }]
        }
    },
    "actions": {
        "toggle": {
            "@type" : "iot:SwitchStatus",
            "description" : "Turn on or off the lamp",
            "forms": [{
                "href": "coaps://mylamp.example.com/toggle",
                "mediaType": "application/json"
            }]
        }
    },
    "events": {
        "overheating": {
            "@type" : "iot:TemperatureAlarm",
            "description" : "Lamp reaches a critical temperature (overheating)",
            "type": "string",
            "forms": [{
                "href": "coaps://mylamp.example.com/oh",
                "mediaType": "application/json"
            }]
        }
    }
}
</pre>
  </section>

  </section>
     
  <section id="security-consideration">
  <h4>Security and Privacy Considerations</h4>
  
  <p class="ednote">
  Please see the
  <a href="https://github.com/w3c/wot-security/">WoT Security and Privacy</a>
  repository for work in progress regarding threat models, assets, risks, 
  recommended mitigations,
  and best practices for security and privacy for systems 
  using the Web of Things.
  Once complete,
  security and privacy considerations relevant to Thing Descriptions will 
  be summarized in this section.
  </p>
  </section>

  <section   id="json-schema-4-validation" class="appendix normative">
  <h1>JSON Schema for TD Instance Validation</h1>

<pre class="advisement">
{td.json-schema.validation}
</pre>

  </section>

  <section id="changes" class="appendix">
  <h1>Recent Specification Changes</h1>
  <h2 id="changes2">Changes from Second Public Working Draft</h2>
  <ul>
    <li>The default serialization format for Thing Description is now 
        plain JSON. 
        Thing Description instances still MAY contain JSON-LD keys such 
        as @context and @type for facilitating semantic evaluation of TDs.</li>
    <li>With regards to JSON-LD, this Thing Description draft uses JSON-LD 1.1 
        instead of JSON-LD 1.0. With this transition, 
        all vocabulary terms defined in vocabulary definition sections 
        now have a JSON key representation.
        Previously, 
        there were vocabulary terms represented as key values in TDs.</li>
    <li>Added a section about media types used for exchanging TDs.</li>
    <li>Added a section about implementation notes that provide useful 
        clarifications to implementors.</li>
    <li>A JSON Schema is provided in the appendix section 
        "JSON Schema for TD Instance Validation" 
        to facilitate the validation of Thing Description instances.</li>
    <li>Some vocabulary terms (e.g., writable, observable, mediaType) 
        now have default values that are used by Thing Description processors 
        when they are absent in TD instances.  Note that security
        schemes can also have such values.</li>
    <li>In addition to core Thing Description vocabulary, 
        Thing Description now has the data schema vocabulary reflecting a 
        subset of JSON Schema terms as linked data representation and 
        the security vocabulary for defining security based conditions.</li>
    <li>Things now have a mandatory field "id" for uniquely identifying a Thing, 
        and an optional field "support" to provide information about 
        Thing Description maintainer.</li>
    <li>Interaction patterns have an optional "label" field providing text 
        for such uses as user interfaces.</li>
    <li>A security field was introduced, 
        and is available at three levels 
        (Thing, Interaction Patterns and Forms) for providing security 
        requirements for accessing resources.</li>
  </ul>

  <h2 id="changes1">Changes from First Public Working Draft</h2>
  <p>Changes from First Public Working Draft are described in the 
  <a href="https://www.w3.org/TR/2018/WD-wot-thing-description-20180405/#changes">Second Public Working Draft</a>
  </p>

  </section>

  <section   id="acknowledgements" class="appendix normative">
  <h1>Acknowledgements</h1>
  <p>tbd</p>
  </section>

</body>
</html>
